import requests
import json
import csv
from datetime import date 

# Calling the response
# url = "https://covid-19-india-data-by-zt.p.rapidapi.com/GetIndiaStateWiseData"
# headers = {
#     'x-rapidapi-host': "covid-19-india-data-by-zt.p.rapidapi.com",
#     'x-rapidapi-key': "####"
#     }
# response = requests.request("GET", url, headers=headers)

#Fetching the json data
# json_data = json.loads(response.text)
json_data = {u'data': [{u'migratedother': u'298', u'confirmed': u'267665', u'code': u'MH', u'name': u'Maharashtra', u'deaths': u'10695', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'107665', u'recovered': u'149007', u'lastupdatedtime': u'2020-07-14 20:12:00'}, {u'migratedother': u'0', u'confirmed': u'147324', u'code': u'TN', u'name': u'Tamil Nadu', u'deaths': u'2099', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'47915', u'recovered': u'97310', u'lastupdatedtime': u'2020-07-14 20:12:02'}, {u'migratedother': u'0', u'confirmed': u'115346', u'code': u'DL', u'name': u'Delhi', u'deaths': u'3446', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'18664', u'recovered': u'93236', u'lastupdatedtime': u'2020-07-14 20:12:04'}, {u'migratedother': u'0', u'confirmed': u'43723', u'code': u'GJ', u'name': u'Gujarat', u'deaths': u'2070', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'11098', u'recovered': u'30555', u'lastupdatedtime': u'2020-07-14 20:26:59'}, {u'migratedother': u'4', u'confirmed': u'44077', u'code': u'KA', u'name': u'Karnataka', u'deaths': u'846', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'25836', u'recovered': u'17391', u'lastupdatedtime': u'2020-07-14 20:12:06'}, {u'migratedother': u'0', u'confirmed': u'39724', u'code': u'UP', u'name': u'Uttar Pradesh', u'deaths': u'983', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'13760', u'recovered': u'24981', u'lastupdatedtime': u'2020-07-14 20:12:02'}, {u'migratedother': u'0', u'confirmed': u'37745', u'code': u'TG', u'name': u'Telangana', u'deaths': u'375', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'12530', u'recovered': u'24840', u'lastupdatedtime': u'2020-07-14 22:16:59'}, {u'migratedother': u'0', u'confirmed': u'35451', u'code': u'AP', u'name': u'Andhra Pradesh', u'deaths': u'452', u'newconfirmed': u'2432', u'newrecovered': u'911', u'newdeaths': u'44', u'active': u'16621', u'recovered': u'18378', u'lastupdatedtime': u'2020-07-15 16:39:59'}, {u'migratedother': u'0', u'confirmed': u'32838', u'code': u'WB', u'name': u'West Bengal', u'deaths': u'980', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'11927', u'recovered': u'19931', u'lastupdatedtime': u'2020-07-14 20:12:02'}, {u'migratedother': u'0', u'confirmed': u'25806', u'code': u'RJ', u'name': u'Rajasthan', u'deaths': u'527', u'newconfirmed': u'235', u'newrecovered': u'30', u'newdeaths': u'3', u'active': u'6080', u'recovered': u'19199', u'lastupdatedtime': u'2020-07-15 11:16:59'}, {u'migratedother': u'0', u'confirmed': u'22628', u'code': u'HR', u'name': u'Haryana', u'deaths': u'312', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'5226', u'recovered': u'17090', u'lastupdatedtime': u'2020-07-13 20:43:19'}, {u'migratedother': u'0', u'confirmed': u'20173', u'code': u'BR', u'name': u'Bihar', u'deaths': u'143', u'newconfirmed': u'1320', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'7011', u'recovered': u'13019', u'lastupdatedtime': u'2020-07-15 15:11:59'}, {u'migratedother': u'0', u'confirmed': u'19005', u'code': u'MP', u'name': u'Madhya Pradesh', u'deaths': u'673', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'4757', u'recovered': u'13575', u'lastupdatedtime': u'2020-07-14 20:27:01'}, {u'migratedother': u'3', u'confirmed': u'18667', u'code': u'AS', u'name': u'Assam', u'deaths': u'51', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'6439', u'recovered': u'12174', u'lastupdatedtime': u'2020-07-15 00:37:59'}, {u'migratedother': u'0', u'confirmed': u'14898', u'code': u'OR', u'name': u'Odisha', u'deaths': u'101', u'newconfirmed': u'618', u'newrecovered': u'612', u'newdeaths': u'5', u'active': u'4321', u'recovered': u'10476', u'lastupdatedtime': u'2020-07-15 17:27:00'}, {u'migratedother': u'0', u'confirmed': u'11173', u'code': u'JK', u'name': u'Jammu and Kashmir', u'deaths': u'195', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'4755', u'recovered': u'6223', u'lastupdatedtime': u'2020-07-14 21:19:00'}, {u'migratedother': u'0', u'confirmed': u'8511', u'code': u'PB', u'name': u'Punjab', u'deaths': u'213', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'2635', u'recovered': u'5663', u'lastupdatedtime': u'2020-07-14 20:12:02'}, {u'migratedother': u'4', u'confirmed': u'8931', u'code': u'KL', u'name': u'Kerala', u'deaths': u'35', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'4454', u'recovered': u'4438', u'lastupdatedtime': u'2020-07-14 20:12:02'}, {u'migratedother': u'0', u'confirmed': u'4379', u'code': u'CT', u'name': u'Chhattisgarh', u'deaths': u'20', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'1084', u'recovered': u'3275', u'lastupdatedtime': u'2020-07-14 21:41:01'}, {u'migratedother': u'0', u'confirmed': u'4246', u'code': u'JH', u'name': u'Jharkhand', u'deaths': u'36', u'newconfirmed': u'21', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'1782', u'recovered': u'2428', u'lastupdatedtime': u'2020-07-15 12:26:59'}, {u'migratedother': u'33', u'confirmed': u'3686', u'code': u'UT', u'name': u'Uttarakhand', u'deaths': u'50', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'736', u'recovered': u'2867', u'lastupdatedtime': u'2020-07-14 20:29:00'}, {u'migratedother': u'0', u'confirmed': u'2753', u'code': u'GA', u'name': u'Goa', u'deaths': u'18', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'1128', u'recovered': u'1607', u'lastupdatedtime': u'2020-07-14 22:41:01'}, {u'migratedother': u'0', u'confirmed': u'1524', u'code': u'UN', u'name': u'State Unassigned', u'deaths': u'0', u'newconfirmed': u'-655', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'1524', u'recovered': u'0', u'lastupdatedtime': u'2020-07-15 09:44:01'}, {u'migratedother': u'14', u'confirmed': u'2183', u'code': u'TR', u'name': u'Tripura', u'deaths': u'2', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'629', u'recovered': u'1538', u'lastupdatedtime': u'2020-07-14 22:41:02'}, {u'migratedother': u'0', u'confirmed': u'1672', u'code': u'MN', u'name': u'Manipur', u'deaths': u'0', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'652', u'recovered': u'1020', u'lastupdatedtime': u'2020-07-14 21:41:02'}, {u'migratedother': u'0', u'confirmed': u'1596', u'code': u'PY', u'name': u'Puducherry', u'deaths': u'21', u'newconfirmed': u'65', u'newrecovered': u'60', u'newdeaths': u'3', u'active': u'686', u'recovered': u'889', u'lastupdatedtime': u'2020-07-15 17:42:00'}, {u'migratedother': u'13', u'confirmed': u'1312', u'code': u'HP', u'name': u'Himachal Pradesh', u'deaths': u'10', u'newconfirmed': u'3', u'newrecovered': u'8', u'newdeaths': u'0', u'active': u'343', u'recovered': u'946', u'lastupdatedtime': u'2020-07-15 12:27:00'}, {u'migratedother': u'0', u'confirmed': u'1128', u'code': u'LA', u'name': u'Ladakh', u'deaths': u'1', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'181', u'recovered': u'946', u'lastupdatedtime': u'2020-07-14 20:12:02'}, {u'migratedother': u'0', u'confirmed': u'902', u'code': u'NL', u'name': u'Nagaland', u'deaths': u'0', u'newconfirmed': u'6', u'newrecovered': u'2', u'newdeaths': u'0', u'active': u'554', u'recovered': u'348', u'lastupdatedtime': u'2020-07-15 16:06:00'}, {u'migratedother': u'0', u'confirmed': u'600', u'code': u'CH', u'name': u'Chandigarh', u'deaths': u'10', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'144', u'recovered': u'446', u'lastupdatedtime': u'2020-07-14 20:41:01'}, {u'migratedother': u'7', u'confirmed': u'545', u'code': u'DN', u'name': u'Dadra and Nagar Haveli and Daman and Diu', u'deaths': u'1', u'newconfirmed': u'4', u'newrecovered': u'11', u'newdeaths': u'0', u'active': u'183', u'recovered': u'354', u'lastupdatedtime': u'2020-07-15 14:57:00'}, {u'migratedother': u'0', u'confirmed': u'462', u'code': u'AR', u'name': u'Arunachal Pradesh', u'deaths': u'3', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'306', u'recovered': u'153', u'lastupdatedtime': u'2020-07-15 06:17:00'}, {u'migratedother': u'0', u'confirmed': u'337', u'code': u'ML', u'name': u'Meghalaya', u'deaths': u'2', u'newconfirmed': u'19', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'289', u'recovered': u'46', u'lastupdatedtime': u'2020-07-15 09:55:00'}, {u'migratedother': u'0', u'confirmed': u'238', u'code': u'MZ', u'name': u'Mizoram', u'deaths': u'0', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'79', u'recovered': u'159', u'lastupdatedtime': u'2020-07-14 22:17:04'}, {u'migratedother': u'0', u'confirmed': u'171', u'code': u'AN', u'name': u'Andaman and Nicobar Islands', u'deaths': u'0', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'42', u'recovered': u'129', u'lastupdatedtime': u'2020-07-14 22:17:05'}, {u'migratedother': u'13', u'confirmed': u'211', u'code': u'SK', u'name': u'Sikkim', u'deaths': u'0', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'112', u'recovered': u'86', u'lastupdatedtime': u'2020-07-14 20:41:03'}, {u'migratedother': u'0', u'confirmed': u'0', u'code': u'LD', u'name': u'Lakshadweep', u'deaths': u'0', u'newconfirmed': u'0', u'newrecovered': u'0', u'newdeaths': u'0', u'active': u'0', u'recovered': u'0', u'lastupdatedtime': u'2020-03-26 07:19:29'}], u'statusMsg': u'OK'}

# open a file for writing raw data and create the csv writer object
file_name = str(date.today()) + "-state_wise.csv"
with open(file_name, 'wb') as data_file:
    csv_writer = csv.writer(data_file) 
    count = 0
    for raw in json_data['data']: 
        if count == 0: 
    
            # Writing headers of CSV file
            header = ["S. No."," Name of State/ UT", "Total Confirmed cases", "Cured/Discharged", "Death"]
            csv_writer.writerow(header) 
            count += 1
    
        # Writing data of CSV file 
        val = []
        val.append(str(count))
        val.append(raw['name'])
        val.append(raw['confirmed'])
        val.append(raw['recovered'])
        val.append(raw['deaths'])
        csv_writer.writerow(val) 
        count += 1
